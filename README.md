# You-KB: YouTube AI Knowledge Base & RAG Chat

Transform any YouTube video, playlist, or channel into a local searchable knowledge base. You-KB downloads transcripts (or generates them using Gemini AI) and provides an interactive RAG (Retrieval-Augmented Generation) chat interface with smart citations and direct timestamp links.

## Core Features

- ðŸ§  **AI Knowledge Base**: Index YouTube transcripts into a local LanceDB vector database for semantic search.
- ðŸ’¬ **RAG Chat**: Ask questions about the content and get accurate answers generated by Gemini 3 Flash.
- ðŸ”— **Smart Citations**: Every AI response includes direct clickable YouTube timestamp links (`https://youtu.be/...?t=N`) to the exact moment in the video.
- ðŸ”„ **AI Transcription Fallback**: If a video lacks subtitles, You-KB automatically extracts the audio and uses Gemini to generate high-accuracy transcripts.
- ðŸ“¥ **Bulk Downloader**: Efficiently fetch subtitles from individual videos, playlists, or entire channels.
- âš¡ **Parallel Processing**: High-performance metadata extraction and batch downloads using parallel workers.
- ðŸ“Š **Insightful Stats**: Real-time progress bars and detailed statistics on subtitle availability and video durations.

## Feature List
- âœ… Semantic search and chat via LanceDB & Gemini
- âœ… Automatic YouTube timestamp link generation
- âœ… Gemini-powered audio-to-text transcription
- âœ… Support for playlists and channels (600+ videos tested)
- âœ… Multiple language support
- âœ… Detailed statistics summary
- âœ… Dev Container support for easy setup (includes ffmpeg)

## Installation

1. Clone this repository:
```bash
git clone <your-repo-url>
cd ytkb
```

2. Create a virtual environment (recommended):
```bash
python3 -m venv venv
source venv/bin/activate  # On Windows: venv\Scripts\activate
```

3. Install dependencies:
```bash
pip install -r requirements.txt
```

4. **Add your Gemini API Key:**
Create a file named `myapikey.txt` in the root directory and paste your Gemini API key inside it.
```bash
echo "YOUR_GEMINI_API_KEY" > myapikey.txt
```

### Dev Container (Recommended)

This project includes a `.devcontainer` configuration for VS Code. This is the recommended way to develop as it:
- Automatically installs **ffmpeg** (required for audio extraction).
- Sets up the Python environment and installs all dependencies.
- Configures VS Code extensions for Python and linting.

**To use it:**
1. Install the [Dev Containers](https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.remote-containers) extension in VS Code.
2. Click **Reopen in Container** when prompted, or run `Dev Containers: Reopen in Container` from the Command Palette.

## Usage

### 1. The Downloader (Fetch & Transcribe)

You-KB downloads official subtitles first. If none are available, it automatically falls back to Gemini AI transcription.

**List videos & check availability:**
```bash
python3 main.py <URL> --list
```

**Download & Transcribe:**
```bash
# Single video
python3 main.py "https://www.youtube.com/watch?v=VIDEO_ID"

# Entire Playlist (using custom output folder)
python3 main.py "https://www.youtube.com/playlist?list=PLAYLIST_ID" --output my_data
```

### 2. The Knowledge Base (Index & Chat)

Once you have downloaded transcripts (VTT files), you can index them into a local vector database for chatting.

**Create/Update Knowledge Base:**
Index everything in your `downloads/` folder into a database named `my_kb`.
```bash
python3 main.py --kb-create my_kb
```

**Interactive AI Chat:**
Ask questions and get answers with direct YouTube timestamp citations.
```bash
python3 main.py --chat my_kb
```

### 3. End-to-End Example

```bash
# 1. Download & Transcribe 3 videos from a playlist
python3 main.py "https://youtube.com/playlist?list=PL45a..." --limit 3

# 2. Index transcripts into a Knowledge Base named 'adult_learning'
python3 main.py --kb-create adult_learning

# 3. Chat with the Knowledge Base (Includes direct YT links)
python3 main.py --chat adult_learning
```

| Option | Description | Default |
|--------|-------------|---------|
| `url` | YouTube video, playlist, or channel URL (Optional for RAG) | Required |
| `--list` | List videos and subtitle info without downloading | False |
| `--limit N` | Limit number of videos to process | All videos |
| `--lang LANG` | Subtitle language code (e.g., en, es, fr) | en |
| `--output DIR` | Output directory for downloads and KB source | downloads |
| `--kb-create NAME` | Create/update a knowledge base from transcripts | None |
| `--chat NAME` | Start a chat session with the specified KB | None |

## Statistics Output

When using `--list`, you'll see a statistics summary including:
- Total videos processed
- Number of videos with subtitles (with percentage)
- Number of videos with auto-generated subtitles (with percentage)
- Average video duration
- Total playlist duration

**Example output:**
```
============================================================
STATISTICS
============================================================
Total videos processed:        647
Videos with subtitles:         1 (0.2%)
Videos with auto-subtitles:    0 (0.0%)
Videos with any subtitles:     1 (0.2%)
Average duration:              22m 14s (1334s)
Total duration:                239h 59m (863940s)
============================================================
```

## Output Format

Subtitles are saved in `.vtt` format, organized by uploader:
```
downloads/
â””â”€â”€ ChannelName/
    â”œâ”€â”€ Video Title 1.en.vtt
    â”œâ”€â”€ Video Title 2.en.vtt
    â””â”€â”€ ...
```

## Performance

- Uses parallel processing with 10 concurrent workers
- Efficiently handles large playlists (tested with 600+ videos)
- Real-time progress updates to avoid appearing frozen

## Dependencies

- `yt-dlp` - YouTube video/subtitle extraction
- `tqdm` - Progress bar display
- `google-generativeai` - Gemini embeddings and text generation
- `lancedb` - Vector database for RAG
- `pandas` - Data handling for LanceDB

## Troubleshooting

**Private videos:** Some videos in playlists may be private. These will show an error but won't stop the overall process.

**No subtitles available:** Not all videos have subtitles. The tool will attempt to download auto-generated subtitles as a fallback.

**JavaScript runtime warnings:** The tool is configured to avoid these warnings by using the iOS client, but you may occasionally see them for certain videos.

## License

MIT

## Contributing

Contributions are welcome! Please feel free to submit a Pull Request.
